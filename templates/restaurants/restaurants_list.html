{% extends 'base.html' %}
{% load static %}

{% block content %}
    <div class="flex flex-col items-center justify-center max-w-full h-24 mt-4 bg-no-repeat bg-cover bg-center" style="background-image:url('{% static 'img/ygy_bg.jpg' %}')">
        <div class="flex justify-center w-full">
            <div class="flex flex-col justify-center bg-green-500 rounded-l-lg">
                <span class="text-center font-medium text-lg w-20 text-white">주소</span>
            </div>
            <input type="search" class="pl-3 h-10 w-1/4 rounded-r-lg" value="서울시 송파구 문정2동..." placeholder="건물명, 도로명, 지명으로 검색하세요." required />
        </div>
    </div>
    <div id="contents">
        <div class="flex px-64 py-2 mb-3 border-b border-gray-500">
            <ul class="flex justify-between items-center w-2/3">
                <li v-on:click="fetch_all_restaurants(group.id)" v-for="group in groups" v-if="group.id != 1" class="px-2">
                    <div v-on:click="ChangeUrl(group.id)" class="border-b-2 border-white hover:border-black">
                       <span class="text-black cursor-pointer">[[group.name]]</span>
                    </div>
                </li>
            </ul>
            <div class="flex justify-end w-1/3 h-full">
                <input v-on:keyup.enter="search_restaurants()" v-model:trim="name" class="p-0 pl-2 w-3/4 h-8 text-sm" type="text" placeholder="음식점 또는 메뉴로 검색">
            </div>
        </div>
        <div class="flex flex-wrap px-64 text mb-3">
            <div class="w-full flex flex-wrap">
                <a v-for="restaurant in restaurants" class="w-1/2 h-32" href="#">
                    <div class="flex p-3 border border-gray-400">
                        <div class="w-24 h-24 bg-cover bg-center" v-bind:style="{'background-image': 'url(../../media/' + restaurant.photo + ')' }"></div>    
                        <div class="flex flex-col p-3 ml-3">
                            <span class="text-black">[[restaurant.name]]</span>
                            <span class="mt-3 text-black text-xs">배달요금 : [[restaurant.delivery_cost]]원 | 최소주문금액 : [[restaurant.minimum_amount]]원</span>
                        </div>   
                    </div>
                </a>
            </div>
        </div>
    </div>
{% endblock content %}

{% block javascript %}
<script type="text/javascript">
function ChangeUrl(g_id) {
    if(typeof(history.pushState) != "undefined") {
        history.pushState(null, null, "../../groups/" + g_id + "/")
    }
    else {
        location.href = "../../groups/" + g_id + "/";
    }
}
</script>
<script>
    // CSRF Token 관련하여 전역변수로 선언
    axios.defaults.xsrfCookieName = 'csrftoken';
    axios.defaults.xsrfHeaderName = 'X-CSRFToken';
    var id = 0;
    var vm = new Vue({
        delimiters: ["[[", "]]"],
        el: "#contents",
        data: {
            
            name: "",
            groups: [],
            restaurants: [],
            group_id: "{{group_id}}",
        },
        created: function () {
            console.log("created()");
            this.fetch_all_groups();
            this.fetch_all_restaurants(id);
        },
        methods: {
            fetch_all_groups: function () {
                var vm = this;

                axios.get("/api/groups-bar/")
                    .then(function (res) {
                        console.log("res.data", res.data);
                        vm.groups = res.data;
                        
                    })
                    .catch(function (err) {
                        console.log("GET ERR", err);
                    })
            },
            fetch_all_restaurants: function (g_id) {
                var vm = this;
                if (g_id == 0) {
                    g_id = {{group_id}};
                }
                console.log(g_id);
                axios.get("/api/" + g_id + "/restaurants-list/")
                    .then(function (res) {
                        console.log("res.data", res.data);
                        vm.restaurants = res.data;
                        console.log("vm.restaurants", vm.restaurants);
                    })
                    .catch(function (err) {
                        console.log("GET ERR", err);
                    })
            },
            search_restaurants: function () {
                var vm = this;
                var postData = {name: this.name};
                console.log(postData);
                axios.post("/api/search-restaurants/", postData)
                    .then(function (res) {
                        console.log("post res.data", res.data);
                        vm.restaurants = res.data;
                        console.log("post vm.restaurants", vm.restaurants);
                    })
                    .catch(function (err) {
                        console.log("POST ERR", err)
                    })
                this.name = "";
            },
        },
    })
</script>
{% endblock javascript %}
